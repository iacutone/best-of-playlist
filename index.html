<!DOCTYPE html>
<html>
  <head>
    <title>Best Of</title>
    <link rel="stylesheet" href="style.css">
    <link rel=icon href=favicon.ico>
    <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <script src="app.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-38341110-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-38341110-2');
    </script>
  </head>
  <body>
    <div id="container"></div>
    <script>
      var elm = document.getElementById('container');
      var songs = {title: "Top Ten Songs, 2016", songs: [
        {songSource: "songs/The Julie Ruin - I'm Done.webm", songName: "The Julie Ruin - I'm Done", id: "song1"},
        {songSource: "songs/Xenia Rubinos - Mexican Chef.webm", songName: "Xenia Rubinos - Mexican Chef", id: "song2"},
        {songSource: "songs/Klaus Johann Grobe - Geschichten aus erster Hand.webm", songName: "Klaus Johann Grobe - Geschichten aus erster Hand", id: "song3"},
        {songSource: "songs/Acapulco Lips - Awkward Waltz.m4a", songName: "Acapulco Lips - Awkward Waltz", id: "song4"},
        {songSource: "songs/Solange - Cranes in the Sky.webm", songName: "Solange - Cranes in the Sky", id: "song5"},
        {songSource: "songs/Kaytranada - Lite Spots.m4a", songName: "Kaytranada - Lite Spots", id: "song6"},
        {songSource: "songs/Jessy Lanza - It Means I Love You.webm", songName: "Jessy Lanza - It Means I Love You", id: "song7"},
        {songSource: "songs/Badbadnotgood - Time Moves Slow.webm", songName: "Badbadnotgood - Time Moves Slow", id: "song8"},
        {songSource: "songs/Quilt - Roller.webm", songName: "Quilt - Roller", id: "song9"},
        {songSource: "songs/A Tribe Called Quest - The Space Program.mp3", songName: "A Tribe Called Quest - The Space Program", id: "song10"}]};

      app = Elm.Main.embed(elm, songs);
      app.ports.play.subscribe(function(event) {
        var audio = document.getElementById(event);
        playSubscription(app, audio);
      });

      app.ports.pause.subscribe(function(event) {
        removePlayingIdAttr();

        var audio = document.getElementById(event);
        pausePromise(audio, false);
      });

      app.ports.previous.subscribe(function(event) {
        removePlayingIdAttr();

        var audioStop = document.getElementById(event[0]);
        pausePromise(audioStop, true);
        var audioPlay = document.getElementById(event[1]);
        playSubscription(app, audioPlay);
      });

      app.ports.next.subscribe(function(event) {
        removePlayingIdAttr();

        var audioStop = document.getElementById(event[0]);
        pausePromise(audioStop, true);
        var audioPlay = document.getElementById(event[1]);
        playSubscription(app, audioPlay);
      });

      function playSubscription(app, el) {
        el.play();
        app.ports.setDuration.send(el.duration);
        app.ports.setSongId.send(el.id);
        app.ports.setSongName.send(el.name);
        el.parentElement.setAttribute("id", "playing")
      }

      function pausePromise(el, beginning) {
        if (el !== undefined) {
          el.play().then(function() {
            el.pause();
            if (beginning) {
              el.currentTime = 0;
            }
          }).catch(function(error) {
            console.log('Error', error);
          });
        }
      }

      removePlayingIdAttr = function() {
        var songs = document.getElementsByClassName("songs");
        for (i = 0; i < songs.length; i++) {
          songs[i].setAttribute("id", "");
        }
      }
    </script>
  </body>
</html>
